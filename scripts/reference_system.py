import json
import numpy as np
from gensim.models import Word2Vec


def create_reference_data(categories, output_file="reference_data.json"):
    """
    Создание справочной таблицы с ключевыми словами и описаниями.
    """
    reference_data = []

    for category_name, category_info in categories.items():
        avg_vector = category_info['avg_vector']
        model_path = category_info['model_path']
        description = category_info['description']

        try:
            # Загрузка модели
            print(f"Загрузка модели для категории '{category_name}' из {model_path}")
            model = Word2Vec.load(model_path)
            print("Модель успешно загружена.")

            # Получение ключевых слов
            closest_words = model.wv.similar_by_vector(np.array(avg_vector), topn=5)

            # Добавление ключевых терминов с описаниями
            key_terms = []
            for word, similarity in closest_words:
                key_terms.append({
                    "term": word,
                    "description": f"Описание для термина '{word}'", 
                    "similarity": similarity
                })

            # Формирование записи для категории
            reference_data.append({
                "category_name": category_name,
                "avg_vector": avg_vector,
                "description": description,
                "key_terms": key_terms
            })

        except FileNotFoundError:
            print(f"Ошибка: модель для категории '{category_name}' не найдена по пути {model_path}.")
        except Exception as e:
            print(f"Неожиданная ошибка для категории '{category_name}': {e}")

    # Сохранение справочных данных в JSON-файл
    with open(output_file, "w", encoding="utf-8") as f:
        json.dump(reference_data, f, ensure_ascii=False, indent=4)
    print(f"Справочные данные сохранены в {output_file}")


if __name__ == "__main__":
    # Данные категорий
    categories = {
        "Медицинская категория ": {
            "avg_vector": [
                0.02435527, 0.19734623, -0.03615692, 0.01739796, 0.33251718, -0.693503,
                0.28779215, 0.90042716, -0.47688633, -0.38773975, 0.05738808, -0.4558251,
                -0.14693652, 0.1080775, -0.06521388, -0.17693472, 0.23899977, -0.19291869,
                -0.3405757, -0.7735627, 0.07135163, -0.19096799, 0.26103762, -0.3197487,
                0.21428433, 0.14598045, -0.34770384, -0.29429686, -0.62771696, 0.21317732,
                0.3217698, 0.03858123, -0.01577785, -0.497605, 0.12027343, 0.7355854,
                0.01166209, -0.15474252, -0.4144915, -0.7042432, -0.07789194, -0.49794465,
                -0.01804082, 0.11385439, 0.271176, 0.09118324, -0.73554134, -0.11672114,
                0.04512364, 0.20836265, 0.14724258, -0.07283169, -0.26895988, 0.05124465,
                -0.3422095, 0.09854013, 0.16179535, -0.17690623, -0.5043119, 0.42240754,
                0.13573164, -0.03207177, 0.26257733, 0.01929256, -0.43513495, 0.33419627,
                0.10286517, 0.19560966, -0.32969004, 0.2607934, -0.19316885, 0.6107819,
                0.388244, -0.1372613, 0.58175814, -0.00891168, 0.14392675, -0.04199678,
                -0.43023577, 0.11150856, -0.02142757, 0.14081174, -0.5009681, 0.72191507,
                -0.06350078, 0.15276435, 0.50583804, 0.5232676, 0.24088462, -0.0222421,
                0.4927414, 0.61438257, 0.10502372, 0.146841, 0.33035222, 0.09885816,
                0.12875234, -0.31119505, -0.04489078, -0.1652643
            ],
            "model_path": "models/medical_word2vec.model",
            "description": "Описание для медицинской категории "
        },
        "ВКР категория ": {
            "avg_vector": [
                -0.01774719, 0.02462751, -0.00569429, 0.00134687, 0.01420656, -0.04862973,
                0.01415915, 0.05132215, -0.0197474, -0.0085617, -0.00921234, -0.03587317,
                -0.01163793, 0.00491713, 0.00190162, -0.01352739, 0.0079481, -0.03316132,
                -0.00336999, -0.036374, 0.02388661, 0.01600831, 0.02507008, -0.01302462,
                0.00091147, -0.00477137, -0.01945634, -0.00436261, -0.01872446, -0.0010335,
                0.02897706, 0.01377231, 0.0022633, -0.01817162, -0.00307935, 0.02602576,
                0.01252416, -0.01966381, -0.01021994, -0.04052968, 0.00155416, -0.0383353,
                -0.00981475, -0.00913103, 0.01297887, -0.01198004, -0.02056447, 0.00373633,
                0.01236804, 0.01752958, 0.00933561, -0.0243791, -0.01025215, 0.00301325,
                -0.01957813, 0.0193915, 0.02754216, -0.0004456, -0.02105277, 0.01519211,
                0.00663728, 0.01305134, -0.00773515, -0.00276238, -0.02181212, 0.01897858,
                0.00405659, 0.01476267, -0.01964866, 0.02985342, -0.01431612, 0.01093319,
                0.02428512, -0.00901622, 0.0257359, 0.00619553, -0.00674032, -0.00486585,
                -0.02065612, 0.00266912, -0.00807089, -0.00039172, -0.02121234, 0.03380284,
                -0.01195095, 0.00144168, -0.00076766, 0.02008812, 0.02318217, 0.00789933,
                0.02940993, 0.01157084, 0.00127378, -0.00180416, 0.0340749, 0.0091801,
                0.02118051, -0.02771094, -0.00108046, 0.0015214
            ],
            "model_path": "models/vkr_word2vec.model",
            "description": "Описание для ВКР категории "
        }
    }

    create_reference_data(categories)
